# ç¬¬äºŒé˜¶æ®µå¼€å‘å®ŒæˆæŠ¥å‘Š

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. ç”¨æˆ·æœåŠ¡ (User Service)
**ä½ç½®**: `services/user/`

**åŠŸèƒ½**:
- âœ… ç”¨æˆ·æ³¨å†Œ
- âœ… ç”¨æˆ·ç™»å½•ï¼ˆJWT è®¤è¯ï¼‰
- âœ… è·å–ä¸ªäººä¿¡æ¯
- âœ… æ›´æ–°ä¸ªäººèµ„æ–™
- âœ… å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆbcryptï¼‰
- âœ… Token è®¤è¯ä¸­é—´ä»¶

**API ç«¯ç‚¹**:
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/user/profile` - è·å–ä¸ªäººä¿¡æ¯
- `PUT /api/user/profile` - æ›´æ–°ä¸ªäººèµ„æ–™
- `GET /api/user/:id` - è·å–å…¶ä»–ç”¨æˆ·ä¿¡æ¯

### 2. èŠå¤©æœåŠ¡ (Chat Service)
**ä½ç½®**: `services/chat/`

**åŠŸèƒ½**:
- âœ… å‘é€æ–‡æœ¬æ¶ˆæ¯
- âœ… å‘é€å¤šåª’ä½“æ¶ˆæ¯ï¼ˆå›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€æ–‡ä»¶ï¼‰
- âœ… è·å–æ¶ˆæ¯å†å²
- âœ… æ¶ˆæ¯çŠ¶æ€ç®¡ç†ï¼ˆå·²å‘é€ã€å·²é€è¾¾ã€å·²è¯»ï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ ï¼ˆé›†æˆ MinIOï¼‰
- âœ… æ¶ˆæ¯å¼•ç”¨å›å¤

**API ç«¯ç‚¹**:
- `POST /api/messages` - å‘é€æ¶ˆæ¯
- `GET /api/messages` - è·å–æ¶ˆæ¯å†å²
- `POST /api/messages/mark-read` - æ ‡è®°æ¶ˆæ¯å·²è¯»
- `POST /api/messages/upload` - ä¸Šä¼ æ–‡ä»¶
- `DELETE /api/messages/:id` - åˆ é™¤æ¶ˆæ¯

### 3. ç¾¤ç»„æœåŠ¡ (Group Service)
**ä½ç½®**: `services/group/`

**åŠŸèƒ½**:
- âœ… åˆ›å»ºç¾¤ç»„
- âœ… åŠ å…¥ç¾¤ç»„
- âœ… é€€å‡ºç¾¤ç»„
- âœ… é‚€è¯·æˆå‘˜
- âœ… ç§»é™¤æˆå‘˜
- âœ… è·å–ç¾¤ç»„åˆ—è¡¨
- âœ… è·å–ç¾¤ç»„æˆå‘˜
- âœ… æƒé™ç®¡ç†ï¼ˆç¾¤ä¸»ã€ç®¡ç†å‘˜ã€æ™®é€šæˆå‘˜ï¼‰

**API ç«¯ç‚¹**:
- `POST /api/group/create` - åˆ›å»ºç¾¤ç»„
- `POST /api/group/join` - åŠ å…¥ç¾¤ç»„
- `POST /api/group/leave` - é€€å‡ºç¾¤ç»„
- `GET /api/group/list` - è·å–ç¾¤ç»„åˆ—è¡¨
- `GET /api/group/:id/members` - è·å–ç¾¤ç»„æˆå‘˜
- `POST /api/group/:id/invite` - é‚€è¯·æˆå‘˜
- `POST /api/group/:id/remove` - ç§»é™¤æˆå‘˜
- `PUT /api/group/:id` - æ›´æ–°ç¾¤ç»„ä¿¡æ¯

### 4. å¥½å‹å…³ç³»ç®¡ç†
**ä½ç½®**: `frontend/src/api/friend.ts`

**åŠŸèƒ½**:
- âœ… æ·»åŠ å¥½å‹
- âœ… åˆ é™¤å¥½å‹
- âœ… è·å–å¥½å‹åˆ—è¡¨
- âœ… ä¿®æ”¹å¥½å‹å¤‡æ³¨
- âœ… é»‘åå•ç®¡ç†
- âœ… åœ¨çº¿çŠ¶æ€æ˜¾ç¤º

**API ç«¯ç‚¹**:
- `POST /api/friendship/add` - æ·»åŠ å¥½å‹
- `DELETE /api/friendship/remove` - åˆ é™¤å¥½å‹
- `GET /api/friendship/list` - è·å–å¥½å‹åˆ—è¡¨
- `PUT /api/friendship/remark` - ä¿®æ”¹å¤‡æ³¨
- `POST /api/blocklist/add` - æ·»åŠ åˆ°é»‘åå•
- `DELETE /api/blocklist/remove` - ä»é»‘åå•ç§»é™¤

### 5. å‰ç«¯ WebSocket é›†æˆ
**ä½ç½®**: `frontend/src/utils/websocket.ts`

**åŠŸèƒ½**:
- âœ… WebSocket å®æ—¶è¿æ¥
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… å®æ—¶æ¶ˆæ¯æ¥æ”¶
- âœ… è¾“å…¥çŠ¶æ€æŒ‡ç¤ºå™¨
- âœ… æ¶ˆæ¯çŠ¶æ€åŒæ­¥
- âœ… è¿æ¥çŠ¶æ€ç®¡ç†

**äº‹ä»¶å¤„ç†**:
- `connect` - è¿æ¥æˆåŠŸ
- `disconnect` - è¿æ¥æ–­å¼€
- `message` - æ¥æ”¶æ¶ˆæ¯
- `status` - çŠ¶æ€æ›´æ–°
- `typing` - è¾“å…¥çŠ¶æ€
- `notification` - é€šçŸ¥

### 6. æ¶ˆæ¯çŠ¶æ€ç®¡ç†
**ä½ç½®**: `frontend/src/stores/chat.ts`

**åŠŸèƒ½**:
- âœ… æ¶ˆæ¯çŠ¶æ€è·Ÿè¸ªï¼ˆsent/delivered/readï¼‰
- âœ… æœªè¯»æ¶ˆæ¯è®¡æ•°
- âœ… ä¼šè¯ç½®é¡¶
- âœ… ä¼šè¯å…æ‰“æ‰°
- âœ… å®æ—¶æ¶ˆæ¯æ›´æ–°
- âœ… è¾“å…¥çŠ¶æ€æ˜¾ç¤º

## ğŸ“Š é¡¹ç›®ç»“æ„

```
microservice_project/
â”œâ”€â”€ frontend/                 # Vue 3 å‰ç«¯
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ api/             # API æ¥å£
â”‚       â”‚   â”œâ”€â”€ index.ts     # Axios é…ç½®
â”‚       â”‚   â”œâ”€â”€ user.ts      # ç”¨æˆ· API
â”‚       â”‚   â”œâ”€â”€ message.ts   # æ¶ˆæ¯ API
â”‚       â”‚   â””â”€â”€ friend.ts    # å¥½å‹ API
â”‚       â”œâ”€â”€ stores/          # Pinia çŠ¶æ€ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ user.ts      # ç”¨æˆ·çŠ¶æ€
â”‚       â”‚   â””â”€â”€ chat.ts      # èŠå¤©çŠ¶æ€
â”‚       â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ Login.vue    # ç™»å½•é¡µ
â”‚       â”‚   â”œâ”€â”€ Register.vue # æ³¨å†Œé¡µ
â”‚       â”‚   â”œâ”€â”€ Chat.vue     # èŠå¤©é¡µ
â”‚       â”‚   â””â”€â”€ Profile.vue  # ä¸ªäººèµ„æ–™é¡µ
â”‚       â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚           â””â”€â”€ websocket.ts # WebSocket æœåŠ¡
â”‚
â”œâ”€â”€ services/                # å¾®æœåŠ¡
â”‚   â”œâ”€â”€ user/                # ç”¨æˆ·æœåŠ¡ (ç«¯å£ 8083)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ config/      # é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/      # è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ middleware/  # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â”‚
â”‚   â”œâ”€â”€ chat/                # èŠå¤©æœåŠ¡ (ç«¯å£ 8084)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ config/      # é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/      # è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ middleware/  # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ Dockerfile
â”‚   â”‚
â”‚   â””â”€â”€ group/               # ç¾¤ç»„æœåŠ¡ (ç«¯å£ 8085)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ config/      # é…ç½®
â”‚       â”‚   â”œâ”€â”€ controllers/ # æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ routes/      # è·¯ç”±
â”‚       â”‚   â””â”€â”€ middleware/  # ä¸­é—´ä»¶
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ Dockerfile
â”‚
â”œâ”€â”€ websocket/               # WebSocket æœåŠ¡ (ç«¯å£ 3001)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ gateway/                 # Nginx ç½‘å…³
â”‚   â””â”€â”€ nginx.conf
â”‚
â”œâ”€â”€ database/                # æ•°æ®åº“
â”‚   â”œâ”€â”€ mysql/
â”‚   â”‚   â””â”€â”€ init.sql         # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ redis/
â”‚
â”œâ”€â”€ storage/                 # æ–‡ä»¶å­˜å‚¨
â”‚   â””â”€â”€ minio/
â”‚
â”œâ”€â”€ docker-compose.yml       # Docker ç¼–æ’
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ä½¿ç”¨ Docker Compose å¯åŠ¨

```bash
cd microservice_project
docker-compose up -d
```

### æœ¬åœ°å¼€å‘

**å‰ç«¯**:
```bash
cd frontend
npm install
npm run dev
```

**ç”¨æˆ·æœåŠ¡**:
```bash
cd services/user
npm install
npm run dev
```

**èŠå¤©æœåŠ¡**:
```bash
cd services/chat
npm install
npm run dev
```

**ç¾¤ç»„æœåŠ¡**:
```bash
cd services/group
npm install
npm run dev
```

**WebSocket æœåŠ¡**:
```bash
cd websocket
npm install
npm run dev
```

## ğŸ“ æŠ€æœ¯æ ˆ

### å‰ç«¯
- Vue 3 + TypeScript
- Vite
- Pinia (çŠ¶æ€ç®¡ç†)
- Vue Router (è·¯ç”±)
- Socket.io-client (å®æ—¶é€šä¿¡)
- Axios (HTTP è¯·æ±‚)

### åç«¯
- Node.js + Express
- MySQL (æ•°æ®åº“)
- Redis (ç¼“å­˜)
- MinIO (æ–‡ä»¶å­˜å‚¨)
- Socket.io (WebSocket)
- JWT (è®¤è¯)
- bcrypt (å¯†ç åŠ å¯†)

### åŸºç¡€è®¾æ–½
- Docker + Docker Compose
- Nginx (åå‘ä»£ç†/è´Ÿè½½å‡è¡¡)

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

æ ¹æ®éœ€æ±‚æ–‡æ¡£çš„ç¬¬ä¸‰é˜¶æ®µè§„åˆ’ï¼Œå»ºè®®å®ç°ï¼š

1. **å¤šåª’ä½“æ¶ˆæ¯æ”¯æŒ**
   - å›¾ç‰‡é¢„è§ˆå’Œå‘é€
   - è¯­éŸ³æ¶ˆæ¯å½•åˆ¶å’Œæ’­æ”¾
   - è§†é¢‘æ¶ˆæ¯
   - æ–‡ä»¶ä¼ è¾“

2. **ç¦»çº¿æ¶ˆæ¯æ¨é€**
   - æ¶ˆæ¯æŒä¹…åŒ–
   - ç¦»çº¿æ¶ˆæ¯å­˜å‚¨
   - æ¨é€é€šçŸ¥

3. **ä¼šè¯ç®¡ç†å®Œå–„**
   - ä¼šè¯æœç´¢
   - æ¶ˆæ¯æœç´¢
   - å†å²è®°å½•å½’æ¡£

4. **ç¾¤ç»„åŠŸèƒ½å¢å¼º**
   - ç¾¤ç»„å…¬å‘Š
   - ç¾¤ç»„è®¾ç½®
   - æˆå‘˜æƒé™ç»†åŒ–

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - æ·»åŠ é€‚å½“çš„ç´¢å¼•
   - ä½¿ç”¨è¿æ¥æ± 
   - è¯»å†™åˆ†ç¦»

2. **ç¼“å­˜ç­–ç•¥**
   - Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
   - ä¼šè¯åˆ—è¡¨ç¼“å­˜
   - åœ¨çº¿ç”¨æˆ·çŠ¶æ€ç¼“å­˜

3. **æ¶ˆæ¯ä¼˜åŒ–**
   - æ¶ˆæ¯åˆ†é¡µåŠ è½½
   - æ¶ˆæ¯å‹ç¼©
   - æ‰¹é‡æ¶ˆæ¯å¤„ç†

4. **WebSocket ä¼˜åŒ–**
   - å¿ƒè·³ä¿æ´»
   - è¿æ¥å¤ç”¨
   - æ¶ˆæ¯é˜Ÿåˆ—

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¼ è¾“å®‰å…¨**
   - ä½¿ç”¨ HTTPS/WSS
   - æ•°æ®åŠ å¯†ä¼ è¾“

2. **è®¤è¯å®‰å…¨**
   - JWT Token è¿‡æœŸæœºåˆ¶
   - åˆ·æ–° Token
   - å¤šå› ç´ è®¤è¯

3. **æ•°æ®å®‰å…¨**
   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
   - SQL æ³¨å…¥é˜²æŠ¤
   - XSS é˜²æŠ¤

4. **è®¿é—®æ§åˆ¶**
   - API é™æµ
   - æƒé™éªŒè¯
   - é»‘åå•ç®¡ç†

---

**ç¬¬äºŒé˜¶æ®µå¼€å‘å®Œæˆï¼** ğŸ‰

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•å’Œéƒ¨ç½²ã€‚